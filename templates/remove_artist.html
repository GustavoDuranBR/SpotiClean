@app.route('/liked_artists', defaults={'page': 1}, methods=['GET', 'POST'])
@app.route('/liked_artists/<int:page>', methods=['GET', 'POST'])
    def liked_artists_view(page):
    sp_handler = get_spotify_handler()
    if not sp_handler:
        return redirect(url_for('login'))

    limit = 10
    offset = (page - 1) * limit

    try:
        # Lidar com a remoção de músicas se o método for POST
        if request.method == 'POST':
            track_ids = request.form.getlist('track_ids')
            if track_ids:
                sp_handler.remove_liked_tracks(track_ids=track_ids)
                flash('Músicas removidas com sucesso!', 'success')
            else:
                flash('Nenhuma música selecionada para remoção.', 'warning')
            return redirect(url_for('liked_tracks', page=page))

        # Recuperar as músicas curtidas
        liked_tracks = sp_handler.sp.current_user_saved_tracks(limit=limit, offset=offset)
        total_tracks = sp_handler.sp.current_user_saved_tracks(limit=1)['total']
        total_pages = (total_tracks // limit) + (total_tracks % limit > 0)

        # Obter a opção de ordenação da query string
        sort_option = request.args.get('sort')

        # Filtrar músicas com base na busca
        search_query = request.args.get('search')
        tracks = [
            {
                'id': track['track']['id'],
                'name': track['track']['name'],
                'artist': track['track']['artists'][0]['name']
            } for track in liked_tracks['items']
        ]

        # Filtrar as faixas conforme a consulta de busca
        if search_query:
            tracks = [track for track in tracks if search_query.lower() in track['name'].lower()]

        # Ordenar as faixas conforme a opção selecionada
        if sort_option == 'name_asc':
            tracks.sort(key=lambda x: x['name'].lower())  # A-Z
        elif sort_option == 'name_desc':
            tracks.sort(key=lambda x: x['name'].lower(), reverse=True)  # Z-A
        elif sort_option == 'artist_asc':
            tracks.sort(key=lambda x: x['artist'].lower())  # Artista A-Z
        elif sort_option == 'artist_desc':
            tracks.sort(key=lambda x: x['artist'].lower(), reverse=True)  # Artista Z-A

        return render_template('liked_tracks.html', tracks=tracks, page=page, total_pages=total_pages)
    except Exception as e:
        logger.error(f"Erro ao recuperar músicas curtidas: {e}")
        flash('Erro ao recuperar músicas curtidas.', 'error')
        return redirect(url_for('dashboard'))